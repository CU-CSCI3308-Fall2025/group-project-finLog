<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FINLOG â€” Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background: #f7f7f7; }
    .admin-badge { background: #dc3545; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; }
    .post-card { border-left: 4px solid #007bff; margin-bottom: 1rem; }
    .post-card.flagged { border-left-color: #ffc107; background-color: #fff3cd; }
    .post-card.deleted { border-left-color: #dc3545; opacity: 0.6; }
    .post-card.approved { border-left-color: #28a745; }
  </style>
</head>
<body>

<header class="p-2 bg-danger text-white">
  <div class="d-flex justify-content-between align-items-center">
    <button class="btn btn-outline-light">â‰¡</button>
    <div class="text-center">
      <h1 class="m-0">FINLOG <span class="admin-badge">ADMIN</span></h1>
      <div class="mt-1">
        <a href="home.html" class="btn btn-outline-light btn-sm me-2">Home</a>
        <a href="dashboard.html" class="btn btn-outline-light btn-sm me-2">User Dashboard</a>
      </div>
    </div>
    <div>
      <span class="me-2" id="loggedInUser">Admin</span>
      <a href="login.html" class="btn btn-outline-light" onclick="sessionStorage.clear()">Logout</a>
    </div>
  </div>
</header>

<main class="container my-4">
  
  
  <section class="mb-4">
    <h2 class="mb-3">Admin Overview</h2>
    <div class="row g-3">
      <div class="col-6 col-md-3">
        <div class="card text-center"><div class="card-body"><h3 id="stat-total-posts" class="text-primary">0</h3><div class="text-muted">Total Posts</div></div></div>
      </div>
      <div class="col-6 col-md-3">
        <div class="card text-center"><div class="card-body"><h3 id="stat-flagged" class="text-warning">0</h3><div class="text-muted">Flagged Posts</div></div></div>
      </div>
      <div class="col-6 col-md-3">
        <div class="card text-center"><div class="card-body"><h3 id="stat-pending" class="text-success">0</h3><div class="text-muted">Pending Review</div></div></div>
      </div>
      <div class="col-6 col-md-3">
        <div class="card text-center"><div class="card-body"><h3 id="stat-approved" class="text-info">0</h3><div class="text-muted">Approved</div></div></div>
      </div>
    </div>
  </section>

  
  <section class="mb-4">
    <div class="card">
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label for="searchInput" class="form-label">Search Posts</label>
            <input type="text" class="form-control" id="searchInput" placeholder="Search by title or user...">
          </div>
          <div class="col-md-4">
            <label for="statusFilter" class="form-label">Status Filter</label>
            <select class="form-select" id="statusFilter">
              <option value="all">All Posts</option>
              <option value="pending">Pending Review</option>
              <option value="approved">Approved</option>
              <option value="flagged">Flagged</option>
            </select>
          </div>
          <div class="col-md-2 d-flex align-items-end">
            <button class="btn btn-secondary w-100" id="clearFilters">Clear</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  
  <section>
    <div class="card">
      <div class="card-header"><h5 class="mb-0">Content Moderation Queue</h5></div>
      <div class="card-body">
        <div id="moderationQueue"></div>
      </div>
    </div>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
const username = sessionStorage.getItem('username');
const userRole = sessionStorage.getItem('userRole');

if (username) {
  document.getElementById('loggedInUser').textContent = username;
}

if (userRole !== 'admin' && username !== 'admin') {
  alert('Access denied. Admin access required.');
  window.location.href = 'dashboard.html';
}

const moderationQueue = document.getElementById("moderationQueue");
let allPosts = [];

const mkImg = label => {
  const div = document.createElement("div");
  div.className = "bg-light d-flex align-items-center justify-content-center";
  div.style.height = "150px";
  div.textContent = label;
  return div;
};

function initializeDemoData() {
  allPosts = [
    {
      id: 1,
      username: "FishMaster123",
      title: "Catch #1 - Bass",
      image: "Bass",
      details: ["Weight: 3.2 lb","Location: Lake Michigan","Bait: Worm","Notes: Calm morning"],
      status: "approved"
    },
    {
      id: 2,
      username: "AnglerPro",
      title: "Catch #2 - Trout",
      image: "Trout",
      details: ["Weight: 1.8 lb","Location: Rocky Creek","Bait: Fly","Notes: Clear water"],
      status: "pending"
    },
    {
      id: 3,
      username: "RiverRat",
      title: "Catch #3 - Pike",
      image: "Pike",
      details: ["Weight: 5.7 lb","Location: Northern Lake","Bait: Spinner","Notes: Overcast"],
      status: "flagged"
    },
    {
      id: 4,
      username: "FishMaster123",
      title: "Catch #4 - Catfish",
      image: "Catfish",
      details: ["Weight: 4.1 lb","Location: Green River","Bait: Cut bait","Notes: Night fishing"],
      status: "approved"
    },
    {
      id: 5,
      username: "NewAngler",
      title: "Catch #5 - Salmon",
      image: "Salmon",
      details: ["Weight: 6.8 lb","Location: Blue Bay","Bait: Lure","Notes: Strong current"],
      status: "pending"
    }
  ];
  updateStats();
  renderPosts();
}

function renderPosts(filteredPosts = null) {
  const posts = filteredPosts || allPosts;
  moderationQueue.innerHTML = "";
  
  if (posts.length === 0) {
    moderationQueue.innerHTML = '<div class="text-center text-muted py-4">No posts found matching your criteria.</div>';
    return;
  }

  posts.forEach(post => {
    const statusClass = post.status === "flagged" ? "flagged" : 
                       post.status === "deleted" ? "deleted" : 
                       post.status === "approved" ? "approved" : "";
    
    const postDiv = document.createElement("div");
    postDiv.className = `card post-card ${statusClass}`;
    postDiv.innerHTML = `
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <div>
            <h6 class="mb-1">${post.title}</h6>
            <div class="small text-muted">
              <strong>User:</strong> ${post.username}<br>
              <span class="badge bg-${getStatusColor(post.status)}">${post.status.toUpperCase()}</span>
            </div>
          </div>
          <div class="d-flex gap-2 flex-wrap">
            <button class="btn btn-sm btn-success" onclick="approvePost(${post.id})" ${post.status === "approved" ? "disabled" : ""}>âœ“ Approve</button>
            <button class="btn btn-sm btn-warning" onclick="flagPost(${post.id})" ${post.status === "flagged" ? "disabled" : ""}>âš  Flag</button>
            <button class="btn btn-sm btn-danger" onclick="deletePost(${post.id})" ${post.status === "deleted" ? "disabled" : ""}>ðŸ—‘ Delete</button>
          </div>
        </div>
        <div class="row">
          <div class="col-md-3"></div>
          <div class="col-md-9">
            <ul class="list-unstyled mb-0">${post.details.map(d=>`<li>${d}</li>`).join("")}</ul>
          </div>
        </div>
      </div>
    `;
    const imgContainer = postDiv.querySelector(".col-md-3");
    imgContainer.appendChild(mkImg(post.image));
    moderationQueue.appendChild(postDiv);
  });
}

function approvePost(postId) {
  const post = allPosts.find(p => p.id === postId);
  if (post) {
    post.status = "approved";
    renderPosts();
    updateStats();
  }
}

function flagPost(postId) {
  const post = allPosts.find(p => p.id === postId);
  if (post) {
    post.status = "flagged";
    renderPosts();
    updateStats();
  }
}

function deletePost(postId) {
  if (confirm("Are you sure you want to delete this post? This action cannot be undone.")) {
    const post = allPosts.find(p => p.id === postId);
    if (post) {
      post.status = "deleted";
      renderPosts();
      updateStats();
    }
  }
}

function updateStats() {
  document.getElementById("stat-total-posts").textContent = allPosts.length;
  document.getElementById("stat-flagged").textContent = allPosts.filter(p => p.status === "flagged").length;
  document.getElementById("stat-pending").textContent = allPosts.filter(p => p.status === "pending").length;
  document.getElementById("stat-approved").textContent = allPosts.filter(p => p.status === "approved").length;
}

document.getElementById("searchInput").addEventListener("input", applyFilters);
document.getElementById("statusFilter").addEventListener("change", applyFilters);
document.getElementById("clearFilters").addEventListener("click", () => {
  document.getElementById("searchInput").value = "";
  document.getElementById("statusFilter").value = "all";
  applyFilters();
});

function applyFilters() {
  const searchTerm = document.getElementById("searchInput").value.toLowerCase();
  const statusFilter = document.getElementById("statusFilter").value;
  let filtered = allPosts;

  if (searchTerm) {
    filtered = filtered.filter(post => 
      post.title.toLowerCase().includes(searchTerm) ||
      post.username.toLowerCase().includes(searchTerm)
    );
  }

  if (statusFilter !== "all") {
    filtered = filtered.filter(post => post.status === statusFilter);
  }

  renderPosts(filtered);
}

function getStatusColor(status) {
  const colors = {
    approved: "success",
    pending: "warning",
    flagged: "danger",
    deleted: "secondary"
  };
  return colors[status] || "secondary";
}

initializeDemoData();
</script>
</body>
</html>
